# custom_components/omlet_smart_coop/services.yaml

# Door Control Services
open_door:
  name: Open Door
  description: Open the coop door immediately
  target:
    entity:
      domain: cover
      integration: omlet_smart_coop

close_door:
  name: Close Door
  description: Close the coop door immediately
  target:
    entity:
      domain: cover
      integration: omlet_smart_coop

update_overnight_sleep:
  name: Update Overnight Sleep Schedule
  description: Update the overnight sleep schedule settings
  fields:
    device_id:
      name: Device
      description: The Omlet Smart Coop device to update
      required: true
      selector:
        device:
          integration: omlet_smart_coop
    enabled:
      name: Enable Overnight Sleep
      description: Enable or disable overnight sleep mode
      required: false
      default: true
      selector:
        boolean: {}
    start_time:
      name: Sleep Start Time
      description: Time to start overnight sleep (format HH:MM)
      required: false
      example: "12:00"
      selector:
        time: {}
    end_time:
      name: Sleep End Time
      description: Time to end overnight sleep (format HH:MM)
      required: false
      example: "13:00"
      selector:
        time: {}
    poll_mode:
      name: Poll Frequency Mode
      description: Select the polling frequency during overnight sleep
      required: false
      default: power_savings
      selector:
        select:
          options:
            - label: Responsive
              value: responsive
            - label: Notifications + Control
              value: power_savings
            - label: Notifications Only
              value: notifications_only
          mode: dropdown

update_door_schedule:
  name: Update Door Schedule
  description: Update the automatic door schedule
  fields:
    device_id:
      name: Device
      description: The Omlet Smart Coop device to update
      required: true
      selector:
        device:
          integration: omlet_smart_coop
    door_mode:
      name: Door Mode
      description: Mode for door operation (light, time, or manual)
      required: true
      selector:
        select:
          options:
            - "light"
            - "time"
            - "manual"
    open_time:
      name: Open Time
      description: Time to open the door (format HH:MM) when in "time" mode
      required: false
      selector:
        time: {}
    close_time:
      name: Close Time
      description: Time to close the door (format HH:MM) when in "time" mode
      required: false
      selector:
        time: {}
    open_light_level:
      name: Open Light Level
      description: Light level to open the door (only for "light" mode)
      required: false
      selector:
        number:
          min: 1
          max: 99
    close_light_level:
      name: Close Light Level
      description: Light level to close the door (only for "light" mode)
      required: false
      selector:
        number:
          min: 1
          max: 99
    open_delay:
      name: Open Delay
      description: Delay in minutes before opening the door (only for "light" mode)
      required: false
      selector:
        number:
          min: 0
          max: 60
    close_delay:
      name: Close Delay
      description: Delay in minutes before closing the door (only for "light" mode)
      required: false
      selector:
        number:
          min: 0
          max: 60

# Utility Services
show_webhook_url:
  name: Show Webhook URL
  description: Create a notification with the webhook URL and status

regenerate_webhook_id:
  name: Regenerate Webhook ID
  description: Unregister current webhook and register a new random one. You must update the Omlet portal with the new URL.

# Fan Configuration Services
turn_fan_on:
  name: Turn Fan On
  description: Turn the fan on immediately (uses Omlet action endpoint)
  fields:
    device_id:
      name: Device
      description: The Omlet fan device to control
      required: true
      selector:
        device:
          integration: omlet_smart_coop

turn_fan_off:
  name: Turn Fan Off
  description: Turn the fan off immediately (uses Omlet action endpoint). Optionally forces Mode to Manual first so it won't auto-restart.
  fields:
    device_id:
      name: Device
      description: The Omlet fan device to control
      required: true
      selector:
        device:
          integration: omlet_smart_coop
    force_manual:
      name: Force Manual Mode First
      description: If enabled, switches fan mode to Manual before turning off (prevents Time/Thermostatic from restarting it)
      required: false
      default: true
      selector:
        boolean: {}

set_fan_mode:
  name: Set Fan Mode
  description: Set the fan operating mode (Manual, Time, Thermostatic) and optionally configure mode-specific settings.
  fields:
    device_id:
      name: Device
      description: The Omlet fan device to update
      required: true
      selector:
        device:
          integration: omlet_smart_coop
    mode:
      name: Mode
      description: Fan mode
      required: true
      selector:
        select:
          options:
            - label: Manual
              value: manual
            - label: Time
              value: time
            - label: Thermostatic
              value: temperature
          mode: dropdown
    apply_immediately:
      name: Apply Immediately
      description: Toggle the fan off/on if currently running to apply changes immediately (recommended)
      required: false
      default: true
      selector:
        boolean: {}
    manual_speed:
      name: Manual Speed
      description: (Manual mode) Optional speed to set when mode is Manual
      required: false
      selector:
        select:
          options:
            - label: Low
              value: low
            - label: Medium
              value: medium
            - label: High
              value: high
          mode: dropdown
    # Time mode settings (optional)
    slot:
      name: Slot
      description: (Time slots) Extra slot number to set/clear (1-3 maps to API slots 2-4). Slot 1 cannot be cleared.
      required: false
      selector:
        number:
          min: 1
          max: 3
          step: 1
    on_time:
      name: On At
      description: (Time mode) Time to turn on (HH:MM)
      required: false
      selector:
        time: {}
    off_time:
      name: Off At
      description: (Time mode) Time to turn off (HH:MM)
      required: false
      selector:
        time: {}
    time_speed:
      name: Time Speed
      description: (Time mode) Speed for the selected slot
      required: false
      selector:
        select:
          options:
            - label: Low
              value: low
            - label: Medium
              value: medium
            - label: High
              value: high
          mode: dropdown
    clear_time_slot:
      name: Clear Time Slot
      description: (Time mode) If enabled, clears the selected slot by setting On/Off to 00:00
      required: false
      default: false
      selector:
        boolean: {}
    # Thermostatic mode settings (optional)
    temp_on:
      name: Temp On
      description: (Thermostatic mode) Temperature to start fan (in your Home Assistant temperature unit)
      required: false
      selector:
        number:
          min: 0
          max: 140
          step: 1
    temp_off:
      name: Temp Off
      description: (Thermostatic mode) Temperature to stop fan (in your Home Assistant temperature unit)
      required: false
      selector:
        number:
          min: 0
          max: 140
          step: 1
    thermostatic_speed:
      name: Thermostatic Speed
      description: (Thermostatic mode) Fan speed when running thermostatically
      required: false
      selector:
        select:
          options:
            - label: Low
              value: low
            - label: Medium
              value: medium
            - label: High
              value: high
          mode: dropdown


